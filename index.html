<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <title>–ê–Ω–∫–µ—Ç–∞ –¥–ª—è –ª—é–±–∏–º–æ–π –∂–∞–Ω–µ—á–∫–∏üíã</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root { --bg:#0b0c10; --card:#121317; --muted:#6b7280; --text:#e5e7eb; --accent:#60a5fa; --danger:#ef4444; --ok:#10b981; }
    * { box-sizing: border-box; }
    body { margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji","Segoe UI Emoji"; background:var(--bg); color:var(--text); }
    .wrap { max-width: 980px; margin: 40px auto; padding: 0 16px; }
    h1 { font-size: 28px; margin: 0 0 18px; }
    .card { background: var(--card); border:1px solid #1f2937; border-radius: 14px; padding: 18px; margin-bottom: 18px; }
    fieldset { border: 1px solid #1f2937; border-radius: 12px; padding: 16px; margin: 0 0 16px; }
    legend { padding: 0 8px; color: var(--muted); font-size: 13px; }
    .grid { display: grid; grid-template-columns: repeat(12, 1fr); gap: 12px; }
    .col-6 { grid-column: span 6; } .col-4 { grid-column: span 4; } .col-3 { grid-column: span 3; } .col-12 { grid-column: span 12; }
    label { display:block; font-size: 13px; color: var(--muted); margin-bottom: 6px; }
    input, select, textarea { width: 100%; padding: 10px 12px; border-radius: 10px; border:1px solid #1f2937; background:#0f1014; color:var(--text); outline: none; }
    textarea { min-height: 70px; resize: vertical; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; }
    .row { display:flex; gap:10px; align-items:center; }
    .btn { cursor: pointer; border: 1px solid #1f2937; background:#0f1014; color:var(--text); padding:10px 14px; border-radius:10px; }
    .btn:hover { border-color:#334155; }
    .btn.accent { background:#0f172a; border-color:#334155; }
    .btn.primary { background: var(--accent); border-color: transparent; color: #0b1020; font-weight: 600; }
    .btn.ghost { background: transparent; }
    .btn.danger { background: #1f0f12; border-color:#3b0d12; color:#ffb4b4; }
    .flex { display:flex; gap:12px; flex-wrap:wrap; }
    .siblings .item { border:1px dashed #253046; padding:12px; border-radius:10px; }
    .bar { display:flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
    .status { font-size: 13px; }
    .ok { color: var(--ok); }
    .err { color: var(--danger); }
    .footer { display:flex; gap:10px; justify-content:flex-end; margin-top: 8px; }
    @media (max-width: 720px){ .col-6,.col-4,.col-3{ grid-column: span 12; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <h1 style="text-align: center;">–ê–ù–ö–ï–¢–ê –ú–û–ï–ô –õ–Æ–ë–ò–ú–û–ô –ñ–ê–ù–ï–ß–ö–ò</h1>
      <div class="status" id="status"></div>
    </div>

    <form id="girlForm" class="card" novalidate>
      <!-- –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
      <fieldset>
        <legend>–û—Å–Ω–æ–≤–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</legend>
        <div class="grid">
          <div class="col-6">
            <label>–ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∞–º–∏–ª–∏—è –æ—Ç—á–µ—Å—Ç–≤–æ</label>
            <input name="full_name" required placeholder="–í–æ—Ç —Å—é–¥–∞ –∂–∞–Ω–µ—á–∫–∞" />
          </div>
          <div class="col-3">
            <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input name="birthday" type="date" />
          </div>
          <div class="col-3">
            <label>–°—Ç–∏–ª—å</label>
            <input name="style" placeholder="casual / sport / romantic" />
          </div>
          <div class="col-3">
            <label>–†–æ—Å—Ç (—Å–º)</label>
            <input name="height_cm" type="number" min="0" step="1" placeholder="165" />
          </div>
          <div class="col-3">
            <label>–í–µ—Å (–∫–≥)</label>
            <input name="weight_kg" type="number" min="0" step="0.1" placeholder="55" />
          </div>
          <div class="col-12">
            <label>–ó–∞–º–µ—Ç–∫–∏</label>
            <textarea name="notes" placeholder="–ï—â–µ –∫–∞–∫–∏–µ –Ω–∏ –±—É–¥—å –ø—Ä–∏–º–µ—á–∞–Ω–∏—è –∏–ª–∏ –¥–æ–±–∞–≤–∫–∏"></textarea>
          </div>
        </div>
      </fieldset>

      <!-- –†–∞–∑–º–µ—Ä—ã -->
      <fieldset>
        <legend>–†–∞–∑–º–µ—Ä—ã</legend>
        <div class="grid">
          <div class="col-3">
            <label>–í–µ—Ä—Ö</label>
            <input name="sizes.clothing_top" placeholder="S / M / 42" />
          </div>
          <div class="col-3">
            <label>–ù–∏–∑</label>
            <input name="sizes.clothing_bottom" placeholder="S / M / 42" />
          </div>
          <div class="col-3">
            <label>–ü–ª–∞—Ç—å–µ</label>
            <input name="sizes.clothing_dress" placeholder="S / M / 42" />
          </div>
          <div class="col-3">
            <label>–û–±—É–≤—å</label>
            <input name="sizes.shoes" placeholder="38" />
          </div>
          <div class="col-3">
            <label>–ö–æ–ª—å—Ü–æ (—Ä–∞–∑–º–µ—Ä)</label>
            <input name="sizes.ring" placeholder="16.5" />
          </div>
          <div class="col-3">
            <label>–ë—é—Å—Ç–≥–∞–ª—å—Ç–µ—Ä</label>
            <input name="sizes.bra" placeholder="75B" />
          </div>
        </div>
      </fieldset>

      <!-- –í–∫—É—Å—ã -->
      <fieldset>
        <legend>–í–∫—É—Å—ã –∏ –ø—Ä–µ–¥–ø–æ—á—Ç–µ–Ω–∏—è (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</legend>
        <div class="grid">
          <div class="col-6">
            <label>–õ—é–±–∏–º—ã–µ —Ü–≤–µ—Ç–∞</label>
            <input name="preferences.favorite_colors" placeholder="—Ä–æ–∑–æ–≤—ã–π, –±–µ–ª—ã–π" />
          </div>
          <div class="col-6">
            <label>–õ—é–±–∏–º—ã–µ —Ü–≤–µ—Ç—ã</label>
            <input name="preferences.favorite_flowers" placeholder="—Ç—é–ª—å–ø–∞–Ω—ã, –æ—Ä—Ö–∏–¥–µ–∏" />
          </div>
          <div class="col-6">
            <label>–õ—é–±–∏–º—ã–µ –¥—É—Ö–∏</label>
            <input name="preferences.favorite_perfumes" placeholder="Dior J'adore" />
          </div>
          <div class="col-6">
            <label>–õ—é–±–∏–º–∞—è –∫—É—Ö–Ω—è</label>
            <input name="preferences.favorite_cuisine" placeholder="–∏—Ç–∞–ª—å—è–Ω—Å–∫–∞—è, —É–∑–±–µ–∫—Å–∫–∞—è" />
          </div>
          <div class="col-6">
            <label>–õ—é–±–∏–º—ã–µ –±–ª—é–¥–∞</label>
            <input name="preferences.favorite_dishes" placeholder="–ø–∞—Å—Ç–∞, –ø–ª–æ–≤" />
          </div>
          <div class="col-6">
            <label>–°–ª–∞–¥–æ—Å—Ç–∏</label>
            <input name="preferences.favorite_sweets" placeholder="—à–æ–∫–æ–ª–∞–¥, –º–∞–∫–∞—Ä—É–Ω—ã" />
          </div>
          <div class="col-6">
            <label>–ù–∞–ø–∏—Ç–∫–∏</label>
            <input name="preferences.favorite_drinks" placeholder="–∫–∞–ø—É—á–∏–Ω–æ, —Å–æ–∫" />
          </div>
          <div class="col-6">
            <label>–ë—Ä–µ–Ω–¥—ã</label>
            <input name="preferences.favorite_brands" placeholder="Zara, H&M" />
          </div>
          <div class="col-6">
            <label>–ú—É–∑—ã–∫–∞</label>
            <input name="preferences.favorite_music" placeholder="K-pop, –ø–æ–ø" />
          </div>
          <div class="col-6">
            <label>–§–∏–ª—å–º—ã/—Å–µ—Ä–∏–∞–ª—ã/–∂–∞–Ω—Ä—ã</label>
            <input name="preferences.favorite_movies" placeholder="—Ä–æ–º–∞–Ω—Ç–∏–∫–∞, –¥—Ä–∞–º—ã" />
          </div>
          <div class="col-6">
            <label>–ö–Ω–∏–≥–∏/–∞–≤—Ç–æ—Ä—ã</label>
            <input name="preferences.favorite_books" placeholder="–î–∂–µ–π–Ω –≠–π—Ä" />
          </div>
          <div class="col-6">
            <label>–õ—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞</label>
            <input name="preferences.favorite_places" placeholder="–ø–∞—Ä–∫, –∫–∞—Ñ–µ —É –æ–∑–µ—Ä–∞" />
          </div>
        </div>
        <p class="hint">–ü–æ–¥—Å–∫–∞–∑–∫–∞: —Ä–∞–∑–¥–µ–ª—è–π –∑–Ω–∞—á–µ–Ω–∏—è –∑–∞–ø—è—Ç—ã–º–∏</p>
      </fieldset>

      <!-- –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ -->
      <fieldset>
        <legend>–ò–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏</legend>
        <div class="grid">
          <div class="col-4">
            <label>–ê–ª–ª–µ—Ä–≥–∏–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)</label>
            <input name="features.allergies" placeholder="–º—ë–¥, —Ü–∏—Ç—Ä—É—Å" />
          </div>
          <div class="col-4">
            <label>–ö–æ—Å–º–µ—Ç–∏–∫–∞ (–±—Ä–µ–Ω–¥—ã/–ª–∏–Ω–µ–π–∫–∏)</label>
            <input name="features.cosmetics" placeholder="Maybelline, Sephora" />
          </div>
          <div class="col-4">
            <label>–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã</label>
            <input name="features.accessories" placeholder="–∫–æ–ª—å—Ü–∞, –±—Ä–∞—Å–ª–µ—Ç—ã" />
          </div>
        </div>
      </fieldset>

      <!-- –ú–µ—á—Ç—ã –∏ –ø–ª–∞–Ω—ã -->
      <fieldset>
        <legend>–ú–µ—á—Ç—ã –∏ –ø–ª–∞–Ω—ã</legend>
        <div class="grid">
          <div class="col-6">
            <label>–ß—Ç–æ —Ö–æ—á–µ—Ç –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å</label>
            <input name="dreams.wants_to_try" placeholder="–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ –≤ –ü–∞—Ä–∏–∂, –≤–µ—Ä—Ö–æ–≤–∞—è –µ–∑–¥–∞" />
          </div>
          <div class="col-6">
            <label>–ö—É–¥–∞ –º–µ—á—Ç–∞–µ—Ç –ø–æ–µ—Ö–∞—Ç—å</label>
            <input name="dreams.travel_destinations" placeholder="–§—Ä–∞–Ω—Ü–∏—è, –¢—É—Ä—Ü–∏—è" />
          </div>
          <div class="col-6">
            <label>–°—Ç—Ä–∞—Ö–∏</label>
            <input name="dreams.fears" placeholder="–≤—ã—Å–æ—Ç–∞" />
          </div>
          <div class="col-6">
            <label>–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å—á–∞—Å—Ç–ª–∏–≤–æ–π –≤ –±—ã—Ç—É</label>
            <input name="dreams.daily_happiness" placeholder="–≥—É–ª—è—Ç—å —Å –ª—é–±–∏–º—ã–º, –∫–æ—Ñ–µ" />
          </div>
        </div>
      </fieldset>

      <!-- –°–µ–º—å—è -->
      <fieldset class="family">
        <legend>–°–µ–º—å—è</legend>
        <div class="grid">
          <div class="col-4">
            <label>–ú–∞–º–∞ ‚Äî –∏–º—è</label>
            <input name="family.mother.name" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∞–º–∏–ª–∏—è –æ—Ç—á–µ—Å—Ç–≤–æ" />
          </div>
          <div class="col-4">
            <label>–ú–∞–º–∞ ‚Äî –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input name="family.mother.birthday" type="date" />
          </div>
          <div class="col-4">
            <label>–ú–∞–º–∞ ‚Äî —Ä–æ–¥ –∑–∞–Ω—è—Ç–∏–π</label>
            <input name="family.mother.occupation" placeholder="–≤—Ä–∞—á" />
          </div>

          <div class="col-4">
            <label>–ü–∞–ø–∞ ‚Äî –∏–º—è</label>
            <input name="family.father.name" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∞–º–∏–ª–∏—è –æ—Ç—á–µ—Å—Ç–≤–æ" />
          </div>
          <div class="col-4">
            <label>–ü–∞–ø–∞ ‚Äî –¥–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è</label>
            <input name="family.father.birthday" type="date" />
          </div>
          <div class="col-4">
            <label>–ü–∞–ø–∞ ‚Äî —Ä–æ–¥ –∑–∞–Ω—è—Ç–∏–π</label>
            <input name="family.father.occupation" placeholder="–∏–Ω–∂–µ–Ω–µ—Ä" />
          </div>
        </div>

        <div class="bar" style="margin-top:12px;">
          <div style="color:var(--muted); font-size:13px;">–ë—Ä–∞—Ç—å—è –∏ —Å—ë—Å—Ç—Ä—ã</div>
          <button type="button" class="btn accent" id="addSiblingBtn">+ –î–æ–±–∞–≤–∏—Ç—å</button>
        </div>
        <div class="siblings" id="siblings"></div>
      </fieldset>

      <div class="footer">
        <button type="reset" class="btn ghost">–°–±—Ä–æ—Å</button>
        <button type="submit" class="btn primary">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
      </div>
    </form>
  </div>

  <script>
    // === –ö–æ–Ω—Ñ–∏–≥ —ç–Ω–¥–ø–æ–∏–Ω—Ç–∞ ===
    const API_URL = "https://zhanka-0014fc790f73.herokuapp.com/api/girls"; // –ø–æ–º–µ–Ω—è–π –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏

    // –£—Ç–∏–ª–∏—Ç—ã
    const by = (sel, root=document) => root.querySelector(sel);
    const all = (sel, root=document) => Array.from(root.querySelectorAll(sel));
    const statusEl = by("#status");

    // –ü—Ä–æ—Å—Ç–æ–π helper –¥–ª—è —Å—Ç—Ä–æ–∫ -> –º–∞—Å—Å–∏–≤ —Å—Ç—Ä–æ–∫
    function toArray(str) {
      if (!str) return [];
      return str
        .split(",")
        .map(s => s.trim())
        .filter(Boolean);
    }

    // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ "a.b.c" –≤ –æ–±—ä–µ–∫—Ç {a:{b:{c:value}}} –∏ –º—ë—Ä–¥–∂ –≤ —Ü–µ–ª–µ–≤–æ–π –æ–±—ä–µ–∫—Ç
    function setDeep(target, path, value) {
      const keys = path.split(".");
      let obj = target;
      for (let i = 0; i < keys.length - 1; i++) {
        const k = keys[i];
        if (!obj[k] || typeof obj[k] !== "object") obj[k] = {};
        obj = obj[k];
      }
      obj[keys[keys.length - 1]] = value;
      return target;
    }

    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±–ª–æ–∫–∞ "–±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞"
    const siblingsWrap = by("#siblings");
    by("#addSiblingBtn").addEventListener("click", () => addSibling());

    function addSibling(data={}) {
      const div = document.createElement("div");
      div.className = "item";
      div.innerHTML = `
        <div class="grid" style="grid-template-columns: auto;">
          <div class="col-5">
            <label>–ò–º—è</label>
            <input name="name" placeholder="–ü–æ–ª–Ω–æ–µ –∏–º—è —Ñ–∞–º–∏–ª–∏—è –æ—Ç—á–µ—Å—Ç–≤–æ" value="${data.name || ""}" />
          </div>
          <div class="col-3">
            <label>–í–æ–∑—Ä–∞—Å—Ç</label>
            <input name="age" type="number" min="0" step="1" placeholder="12" value="${data.age ?? ""}" />
          </div>
          <div class="col-3">
            <label>–ö—Ç–æ?</label>
            <select name="relation">
              <option value="">‚Äî</option>
              <option ${data.relation==="–±—Ä–∞—Ç"?"selected":""}>–±—Ä–∞—Ç</option>
              <option ${data.relation==="—Å–µ—Å—Ç—Ä–∞"?"selected":""}>—Å–µ—Å—Ç—Ä–∞</option>
            </select>
          </div>
          <div class="col-1" style="display:flex;align-items:end;">
            <button type="button" class="btn danger remove">‚úï</button>
          </div>
        </div>
      `;
      div.querySelector(".remove").addEventListener("click", () => div.remove());
      siblingsWrap.appendChild(div);
    }

    // –°–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö —Ñ–æ—Ä–º—ã -> payload –ø–æ —Å—Ö–µ–º–µ Mongoose
    function buildPayload(form) {
      const payload = {};
      const inputs = all("input[name], textarea[name], select[name]", form);

      for (const el of inputs) {
        const name = el.getAttribute("name");
        let value = el.value.trim();

        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –ø–æ–ª—è –≤ –º–∞—Å—Å–∏–≤—ã
        const isArrayField =
          name.startsWith("preferences.") ||
          name.startsWith("features.") ||
          name.startsWith("dreams.");

        if (isArrayField) {
          value = toArray(value);
        } else if (["height_cm","weight_kg"].includes(name)) {
          value = value === "" ? undefined : Number(value);
        } else if (name.includes("birthday")) {
          value = value ? new Date(value).toISOString() : undefined;
        } else if (value === "") {
          value = undefined;
        }

        if (value !== undefined) setDeep(payload, name, value);
      }

      // –ë—Ä–∞—Ç—å—è/—Å–µ—Å—Ç—Ä—ã
      const siblings = [];
      siblingsWrap.querySelectorAll(".item").forEach(item => {
        const [nameEl, ageEl, relationEl] = item.querySelectorAll("input, select");
        const one = {
          name: nameEl.value.trim(),
          age: ageEl.value ? Number(ageEl.value) : undefined,
          relation: relationEl.value || undefined,
        };
        if (one.name || one.age !== undefined || one.relation) siblings.push(one);
      });
      if (siblings.length) setDeep(payload, "family.siblings", siblings);

      return payload;
    }

    // –û—Ç–ø—Ä–∞–≤–∫–∞
    by("#girlForm").addEventListener("submit", async (e) => {
      e.preventDefault();
      statusEl.textContent = "";
      const form = e.currentTarget;

      if (!form.full_name.value.trim()) {
        statusEl.innerHTML = '<span class="err">–í–≤–µ–¥–∏—Ç–µ –ø–æ–ª–Ω–æ–µ –∏–º—è</span>';
        form.full_name.focus();
        return;
      }

      const payload = buildPayload(form);

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(payload),
        });
        const data = await res.json();
        if (!res.ok) throw new Error(data?.error || "–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è");
        statusEl.innerHTML = '<span class="ok">–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ üíã</span>';
        alert('–≤—Å–µ –æ—Ç–ª–∏—á–Ω–æ, —Å–ø–∞—Å–∏–±–æ –∂–∞–Ω–µ—á–∫–∞üíã')
        // –ú–æ–∂–Ω–æ –æ—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ:
        // form.reset(); siblingsWrap.innerHTML = "";
        console.log("Saved:", data);
      } catch (err) {
        console.error(err);
        statusEl.innerHTML = '<span class="err">–û—à–∏–±–∫–∞: ' + err.message + "</span>";
      }
    });
  </script>
</body>
</html>
